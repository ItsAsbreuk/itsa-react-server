(function(t,e){var n=e();if(typeof module==="object"&&module){module.exports=n}if(typeof define==="function"&&define.amd){define(e)}t.PromisePolyfill=n;t.Promise||(t.Promise=n)})(typeof global!=="undefined"?global:this,function(){function t(t){return Object.prototype.toString.call(t)==="[object Array]"}function e(t,e){for(var n in e){if(e.hasOwnProperty(n)){t[n]=e[n]}}}function n(t){if(!(this instanceof n)){throw new TypeError(this+"is not a promise")}if(typeof t!=="function"){throw new TypeError("Promise resolver "+t+" is not a function")}var e=new r;this._resolver=e;try{t(function(t){e.resolve(t)},function(t){e.reject(t)})}catch(i){e.reject(i)}}e(n.prototype,{then:function(t,e){var r,i,s=new this.constructor(function(t,e){r=t;i=e});this._resolver._addCallbacks(typeof t==="function"?n._makeCallback(s,r,i,t):r,typeof e==="function"?n._makeCallback(s,r,i,e):i);return s},"catch":function(t){return this.then(undefined,t)}});n._makeCallback=function(t,e,n,r){return function(i){var s;try{s=r(i)}catch(o){n(o);return}if(s===t){n(new TypeError("Cannot resolve a promise with itself"));return}e(s)}};n.resolve=function(t){if(t&&t.constructor===this){return t}return new this(function(e){e(t)})};n.reject=function(t){var e=new this(function(){});e._resolver._result=t;e._resolver._status="rejected";return e};n.all=function(e){var n=this;return new n(function(r,i){if(!t(e)){i(new TypeError("Promise.all expects an array of values or promises"));return}var s=e.length,o=0,c=e.length,a=[];function f(t){return function(e){a[t]=e;s--;if(!s){r(a)}}}if(c<1){return r(a)}for(;o<c;o++){n.resolve(e[o]).then(f(o),i)}})};n.race=function(e){var n=this;return new n(function(r,i){if(!t(e)){i(new TypeError("Promise.race expects an array of values or promises"));return}for(var s=0,o=e.length;s<o;s++){n.resolve(e[s]).then(r,i)}})};n.async=typeof setImmediate!=="undefined"?function(t){setImmediate(t)}:typeof process!=="undefined"&&process.nextTick?process.nextTick:function(t){setTimeout(t,0)};function r(){this._callbacks=[];this._errbacks=[];this._status="pending";this._result=null}e(r.prototype,{fulfill:function(t){var e=this._status;if(e==="pending"||e==="accepted"){this._result=t;this._status="fulfilled"}if(this._status==="fulfilled"){this._notify(this._callbacks,this._result);this._callbacks=[];this._errbacks=null}},reject:function(t){var e=this._status;if(e==="pending"||e==="accepted"){this._result=t;this._status="rejected"}if(this._status==="rejected"){this._notify(this._errbacks,this._result);this._callbacks=null;this._errbacks=[]}},resolve:function(t){if(this._status==="pending"){this._status="accepted";this._value=t;if(this._callbacks&&this._callbacks.length||this._errbacks&&this._errbacks.length){this._unwrap(this._value)}}},_unwrap:function(t){var e=this,n=false,r;if(!t||typeof t!=="object"&&typeof t!=="function"){e.fulfill(t);return}try{r=t.then;if(typeof r==="function"){r.call(t,function(t){if(!n){n=true;e._unwrap(t)}},function(t){if(!n){n=true;e.reject(t)}})}else{e.fulfill(t)}}catch(i){if(!n){e.reject(i)}}},_addCallbacks:function(t,e){var n=this._callbacks,r=this._errbacks;if(n){n.push(t)}if(r){r.push(e)}switch(this._status){case"accepted":this._unwrap(this._value);break;case"fulfilled":this.fulfill(this._result);break;case"rejected":this.reject(this._result);break}},_notify:function(t,e){if(t.length){n.async(function(){var n,r;for(n=0,r=t.length;n<r;++n){t[n](e)}})}}});n.Resolver=r;return n});